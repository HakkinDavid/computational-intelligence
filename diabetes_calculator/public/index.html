<!DOCTYPE html>
<html>
<head>
    <title>Diabetes Risk Predictor</title>
</head>
<body>
    <h2>Predicción de Riesgo de Diabetes</h2>

    <form id="predictionForm">

        <input type="number" step="1" min="0" max="120" name="age" placeholder="Edad (0-120)" required><br>
        <input type="number" step="0.1" min="10" max="80" name="bmi" placeholder="BMI (10-80)" required><br>
        <input type="number" step="1" min="50" max="250" name="blood_pressure" placeholder="Presión (50-250)" required><br>
        <input type="number" step="1" min="50" max="500" name="fasting_glucose_level" placeholder="Glucosa (50-500)" required><br>
        <input type="number" step="0.1" min="0" max="500" name="insulin_level" placeholder="Insulina (0-500)" required><br>
        <input type="number" step="0.1" min="3" max="20" name="HbA1c_level" placeholder="HbA1c (3-20)" required><br>
        <input type="number" step="1" min="50" max="400" name="cholesterol_level" placeholder="Colesterol (50-400)" required><br>
        <input type="number" step="1" min="30" max="1000" name="triglycerides_level" placeholder="Triglicéridos (30-1000)" required><br>
        <input type="number" step="1" min="500" max="10000" name="daily_calorie_intake" placeholder="Calorías diarias (500-10000)" required><br>
        <input type="number" step="0.1" min="0" max="1000" name="sugar_intake_grams_per_day" placeholder="Azúcar (g/día)" required><br>
        <input type="number" step="0.1" min="0" max="24" name="sleep_hours" placeholder="Horas de sueño (0-24)" required><br>
        <input type="number" step="1" min="0" max="10" name="stress_level" placeholder="Estrés (0-10)" required><br>
        <input type="number" step="0.1" min="30" max="200" name="waist_circumference_cm" placeholder="Cintura (cm)" required><br>

        <select name="gender" required>
            <option value="">Género</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select><br>

        <select name="physical_activity_level" required>
            <option value="">Actividad física</option>
            <option value="Low">Low</option>
            <option value="Moderate">Moderate</option>
            <option value="High">High</option>
        </select><br>

        <select name="family_history_diabetes" required>
            <option value="">Historial familiar</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
        </select><br><br>

        <button type="submit">Predecir</button>
    </form>

    <h3 id="result"></h3>
    <p id="error" style="color:red;"></p>

    <script>
        document.getElementById("predictionForm").addEventListener("submit", async function(e) {
            e.preventDefault();

            const errorElement = document.getElementById("error");
            const resultElement = document.getElementById("result");
            errorElement.innerText = "";
            resultElement.innerText = "";

            const formData = new FormData(this);
            const data = {};

            for (let [key, value] of formData.entries()) {
                if (value === "") {
                    errorElement.innerText = "Todos los campos son obligatorios.";
                    return;
                }

                if (!isNaN(value)) {
                    data[key] = parseFloat(value);
                } else {
                    data[key] = value;
                }
            }

            try {
                const response = await fetch("/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error("Error en el servidor.");
                }

                const result = await response.json();

                if (typeof result.prediction !== "number") {
                    throw new Error("Respuesta inválida del modelo.");
                }

                resultElement.innerText =
                    "Riesgo estimado: " + result.prediction.toFixed(2) + "%";

            } catch (err) {
                errorElement.innerText = "Ocurrió un error durante la predicción.";
            }
        });
    </script>
</body>
</html>